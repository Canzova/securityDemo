=====================================================================
ğŸ§©  AUTHENTRYPOINTJWT EXPLAINED â€” SIMPLE & CLEAR GUIDE
=====================================================================


ğŸ¯ WHAT THIS CLASS DOES
---------------------------------------------------------------------
Think of your API like a locked door ğŸšª.
Only users with the correct key (valid credentials or JWT token) ğŸ”‘
can enter.

If someone tries to enter without a key or with a fake one âŒ:
ğŸ‘‰ Spring Security stops them and calls this class (AuthEntryPointJwt)
to say: â€œUnauthorized! You donâ€™t have permission to access this.â€

This class decides *how* that error message looks
(we make it return a clean JSON message instead of an HTML page).


âš™ï¸ WHEN IT IS TRIGGERED
---------------------------------------------------------------------
This class runs automatically whenever an unauthenticated user
tries to access a protected endpoint.

Examples:
1ï¸âƒ£ User requests /api/profile without logging in
2ï¸âƒ£ User sends wrong username/password
3ï¸âƒ£ User sends invalid or expired JWT token

Spring Security then calls:
â¡ï¸  AuthEntryPointJwt.commence(request, response, exception)


ğŸ§  STEP-BY-STEP CODE EXPLANATION
---------------------------------------------------------------------

1ï¸âƒ£ Implements AuthenticationEntryPoint
    - This interface defines what happens when authentication fails.

2ï¸âƒ£ Logs the error
    logger.error("Unauthorized Error : {}", authException.getMessage());

    ğŸ§¾ Example log:
    Unauthorized Error : Full authentication is required to access this resource

3ï¸âƒ£ Sets response type and status
    response.setContentType(MediaType.APPLICATION_JSON_VALUE);
    response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);

    âœ³ï¸ Tells the client:
        - â€œI am sending a JSON response, not HTMLâ€ You are not converting the response in to a .json file,
        you are just telling client than i am sending a json response.
        - HTTP status code = 401 (Unauthorized)

4ï¸âƒ£ Creates the response body
    final Map<String, Object> body = new HashMap<>();
    body.put("status", 401);
    body.put("error", "Unauthorized");
    body.put("message", authException.getMessage());
    body.put("path", request.getServletPath());

    ğŸ“¦ This builds a JSON structure with useful error details.

    ğŸ’¡ Why final?

    final means you canâ€™t reassign the variable body to point to another object â€”
    but you can still modify the contents inside the HashMap.

    So this is okay:
    body.put("error", "something");

    But this is not okay:
    body = new HashMap<>(); // âŒ can't reassign final variable

5ï¸âƒ£ Writes the JSON to the response
    ObjectMapper mapper = new ObjectMapper();
    mapper.writeValue(response.getOutputStream(), body);

    ğŸ§© Converts the Map into JSON and sends it as the HTTP response.
    - ObjectMapper is from the Jackson library.
    - It converts Java objects (like your Map) into JSON text.
    - response.getOutputStream() means: write that JSON directly into the HTTP response body.


ğŸ’¡ FINAL JSON OUTPUT EXAMPLE
---------------------------------------------------------------------
{
  "status": 401,
  "error": "Unauthorized",
  "message": "Invalid or missing token",
  "path": "/api/secure"
}


âœ… SUMMARY TABLE
---------------------------------------------------------------------
| Step | Purpose                          | Example / Meaning                  |
|------|----------------------------------|------------------------------------|
| 1ï¸âƒ£ | Logs unauthorized access          | "Unauthorized Error: Invalid JWT"  |
| 2ï¸âƒ£ | Sets JSON content type            | Client parses JSON properly        |
| 3ï¸âƒ£ | Sends 401 status code             | Informs client unauthorized        |
| 4ï¸âƒ£ | Builds JSON body                  | {status, error, message, path}     |
| 5ï¸âƒ£ | Writes JSON to output stream      | Client receives formatted JSON     |


ğŸ§  WORKS FOR MORE THAN JUST JWT
---------------------------------------------------------------------
Even though itâ€™s called "AuthEntryPointJwt",
it handles *any* unauthorized access â€” not just token issues.

Triggered for:
- âŒ Invalid username/password
- âŒ Missing authentication
- âŒ Invalid / expired JWT token

ğŸ’¬ The name â€œJwtâ€ is just a convention.
You can rename it to `CustomAuthEntryPoint` â€” itâ€™ll still work the same.


ğŸ§© WHY WE USE response.setContentType(MediaType.APPLICATION_JSON_VALUE)
---------------------------------------------------------------------
This tells the client:
> â€œThe response body Iâ€™m sending is JSON.â€

When you later write:
mapper.writeValue(response.getOutputStream(), body);

â€¦the client (browser, Postman, React app, etc.) knows to treat it as JSON.

Without this line, clients might see plain text or HTML instead.

âœ… So itâ€™s NOT unused â€” it sets the `Content-Type: application/json` header.


ğŸ“˜ COMPLETE REQUEST FLOW
---------------------------------------------------------------------
1ï¸âƒ£ User tries to access `/api/private`
2ï¸âƒ£ Spring Security checks for authentication
3ï¸âƒ£ Authentication fails (no login or bad token)
4ï¸âƒ£ Spring calls `AuthEntryPointJwt.commence()`
5ï¸âƒ£ JSON error message with HTTP 401 is sent
6ï¸âƒ£ Request stops â€” controller is never called


ğŸ“¦ SAMPLE JSON RESPONSE
---------------------------------------------------------------------
{
  "status": 401,
  "error": "Unauthorized",
  "message": "Full authentication is required to access this resource",
  "path": "/api/private"
}


ğŸ§¾ FINAL RECAP
---------------------------------------------------------------------
âœ” Handles ALL unauthorized access (JWT or username/password)
âœ” Converts response to JSON format (API-friendly)
âœ” Sends clear 401 Unauthorized message
âœ” Used automatically by Spring Security
âœ” `setContentType()` sets HTTP header for JSON


ğŸ“Š SIMPLE VISUAL FLOW (TEXT DIAGRAM)
---------------------------------------------------------------------
    CLIENT REQUEST
          â”‚
          â–¼
  ğŸ”’ Spring Security Filter Chain
          â”‚
          â–¼
  âœ… Authenticated? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Yes â†’ Controller executes
          â”‚
          â–¼
         âŒ No
          â”‚
          â–¼
  ğŸš¨ AuthEntryPointJwt.commence()
          â”‚
          â–¼
  ğŸ“¨ Sends JSON:
      {
        "status": 401,
        "error": "Unauthorized"
      }
          â”‚
          â–¼
     ğŸš« Request ends here


=====================================================================
ğŸ END OF EXPLANATION
=====================================================================
